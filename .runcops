#!/bin/bash

function runcops {
	rubybefore=$(rvm current)
	rvm use 2.2.4
	# Changed Files:
	files=$(git status --short | sed -n /\^.\[\^D\]/p | cut -c 4-)
	echo "" > ~/.rutmp
	if [[ -z ${files// } ]]; then
		echo "No changed files found"
		return
	fi
	while read -r f; do
		if [[ $f == *.haml ]]; then
			echo "Running haml-lint on $f"
			haml-lint ${f} --color --config "$HOME/.haml_lint.yml" >> ~/.rutmp
			echo "" >> ~/.rutmp
		elif [[ $f == *.rb ]] || [[ $f == *.rake ]]; then
			echo "Running rubocop on $f"
			rubocop ${f} --color -f "s" | sed '$d' >> ~/.rutmp
		else
			echo "No cop found for $f"
		fi
	done <<< "$files"

	less ~/.rutmp
	rm ~/.rutmp
	rvm use $rubybefore
}
